<!DOCTYPE html>
<html>
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            text-align: center; 
            padding: 0; 
            margin: 0;
            user-select: none;
            display: flex;
            flex-direction: column;
            min-height: 100vh; 
            overflow: auto; 
        }

        header { padding: 20px; }
        #coins { font-size: 48px; font-weight: bold; }
        
        #dice { 
            font-size: 120px; 
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        #dice.anim { animation: diceRoll 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94); }

        @keyframes diceRoll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(360deg) scale(1.4); }
            50% { transform: rotate(720deg) scale(1.7); }
            75% { transform: rotate(1080deg) scale(1.4); }
            100% { transform: rotate(1440deg) scale(1); }
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.75;} }
        @keyframes buttonPulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .main { 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }

        .board-container { 
            width: 100%; 
            overflow-x: auto; 
            padding: 10px 0; 
            -webkit-overflow-scrolling: touch; 
        }

        #board { 
            display: flex; 
            justify-content: flex-start; 
            flex-wrap: nowrap; 
            gap: 10px; 
            padding: 0 20px;
            scroll-snap-type: x proximity; 
        }

        .slot { 
            min-width: 68px; 
            height: 68px; 
            border-radius: 14px; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            font-size: 12px; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            color: white;
            animation: fadeIn 0.5s;
        }

        .slot:hover { transform: scale(1.12); box-shadow: 0 8px 25px rgba(0,0,0,0.4); }

        .current { 
            background: linear-gradient(45deg, #ffd700, #ffaa00) !important; 
            border: 4px solid #ff6600 !important; 
            box-shadow: 0 0 25px #ffaa00, 0 0 15px #ffd700 inset !important; 
            transform: scale(1.15) !important;
        }

        .highlight { 
            background: linear-gradient(45deg, #ffd700, #ff6600) !important; 
            box-shadow: 0 0 50px #ffd700, 0 0 70px #ff6600 !important; 
            transform: scale(1.4) !important; 
            animation: pulse 0.6s infinite !important;
        }

        .locked { background: #444 !important; color: #eee; } 
        .unlocked { background: linear-gradient(45deg, #00ff88, #00cc66); } 

        #progress-bar { width: 80%; height: 8px; background: #333; border-radius: 4px; margin: 10px auto; }
        #progress-fill { height: 100%; background: #ffd700; border-radius: 4px; transition: width 0.5s; }

        footer { 
            display: flex; 
            justify-content: space-around; 
            padding: 15px; 
            background: rgba(0,0,0,0.2); 
            flex-wrap: wrap; 
            gap: 10px; 
        }

        button { 
            background: linear-gradient(45deg, #00ff88, #00cc66); 
            border: none; 
            padding: 10px 20px; 
            font-size: 16px; 
            border-radius: 15px; 
            cursor: pointer; 
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,255,136,0.4);
            transition: all 0.2s;
            display: flex; 
            align-items: center; 
            justify-content: center;
            gap: 5px;
            min-width: 120px; 
            touch-action: manipulation; 
        }

        button:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 6px 20px rgba(0,255,136,0.6); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }

        button.pulse { animation: buttonPulse 1.5s infinite; }

        .prestigeBtn { background: #ffcc00; color: #333; }

        #tutorial-modal { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.8); 
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            align-items: center; 
            justify-content: center; 
            z-index: 10;
        }

        #tutorial-content { 
            background: white; 
            color: black; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: left; 
            max-width: 80%; 
            max-height: 80vh;
            overflow-y: auto;
        }

        @media (max-width: 600px) { 
            .slot { min-width: 60px; height: 60px; font-size: 10px; } 
            button { min-width: 100px; font-size: 14px; } 
            #coins { font-size: 36px; }
            #dice { font-size: 90px; }
        }

        #confetti { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            pointer-events: none; 
            z-index: 5; 
            display: none;
        } 
    </style>
</head>
<body>
    <!-- –î–æ–±–∞–≤–ª–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π HTML-–∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div id="tutorial-modal">
        <div id="tutorial-content">
            <h2>üéÆ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å?</h2>
            <p>1. –ù–∞–∂–º–∏ –Ω–∞ –∫—É–±–∏–∫, —á—Ç–æ–±—ã –±—Ä–æ—Å–∏—Ç—å –µ–≥–æ –∏ –ø—Ä–æ–π—Ç–∏ –ø–æ –ø–æ–ª—é</p>
            <p>2. –ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç—ã –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–ª–æ—Ç–∞—Ö</p>
            <p>3. –û—Ç–∫—Ä—ã–≤–∞–π –∏ —É–ª—É—á—à–∞–π —Å–ª–æ—Ç—ã –∑–∞ –º–æ–Ω–µ—Ç—ã</p>
            <p>4. –ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤</p>
            <button onclick="document.getElementById('tutorial-modal').style.display='none'">–ü–æ–Ω—è—Ç–Ω–æ!</button>
        </div>
    </div>

    <div id="confetti"></div>

    <header>
        <h1>üçÄ –ë—Ä–æ—Å–∫–∏ –ö—É–±–∏–∫–æ–≤ üçÄ</h1>
        <div id="coins">–ú–æ–Ω–µ—Ç—ã: 0</div>
    </header>

    <div class="main">
        <div id="dice">üé≤</div>
        <div id="progress-bar">
            <div id="progress-fill" style="width: 0%"></div>
        </div>
        
        <div class="board-container">
            <div id="board"></div>
        </div>
    </div>

    <footer>
        <button id="rollBtn">üé≤ –ö—Ä—É—Ç–∏—Ç—å! (0/5)</button>
        <button id="adBtn">üì∫ +3 –±—Ä–æ—Å–∫–∞</button>
        <button id="dailyBtn">üéÅ –ï–∂–µ–¥–Ω–µ–≤–∫–∞</button>
        <button id="prestigeBtn" class="prestigeBtn">üîÑ Prestige</button>
        <button id="helpBtn">‚ùì –ü–æ–º–æ—â—å</button>
    </footer>

    <script>
        const boardSize = 20;
        const REGEN_TIME = 600000; // 10 –º–∏–Ω—É—Ç
        const DAY_MS = 86400000;
        const PITY_ROLLS = 20;

        let coins = 0, energy = 0, lastEnergyUpdate = Date.now(), rollsLeft = 0;
        let multipliers = Array(boardSize).fill(1);
        let unlocked = Array(boardSize).fill(false);
        let currentPosition = 0;
        let lastDailyClaim = 0;
        let globalMulti = 1.0;
        let rollsSinceJackpot = 0;
        let prestigeLevel = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        function loadProgress() {
            const saved = localStorage.getItem('diceProgress');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    coins = data.coins || 0;
                    multipliers = data.multipliers || Array(boardSize).fill(1);
                    unlocked = data.unlocked || Array(boardSize).fill(false);
                    currentPosition = data.currentPosition || 0;
                    energy = data.energy || 0;
                    lastEnergyUpdate = data.lastEnergyUpdate || Date.now();
                    lastDailyClaim = data.lastDailyClaim || 0;
                    globalMulti = data.globalMulti || 1.0;
                    prestigeLevel = data.prestigeLevel || 0;
                    rollsSinceJackpot = data.rollsSinceJackpot || 0;
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
                }
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3 —Å–ª–æ—Ç–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
            if (!unlocked.some(u => u)) {
                unlocked[0] = true;
                unlocked[1] = true;
                unlocked[2] = true;
            }
            
            updateEnergy();
            updateUI();
        }

        function saveProgress() {
            const data = {
                coins, multipliers, unlocked, currentPosition,
                energy, lastEnergyUpdate, lastDailyClaim,
                globalMulti, prestigeLevel, rollsSinceJackpot,
                updatedAt: Date.now()
            };
            localStorage.setItem('diceProgress', JSON.stringify(data));
        }

        function updateEnergy() {
            const now = Date.now();
            const elapsed = Math.floor((now - lastEnergyUpdate) / REGEN_TIME);
            if (elapsed > 0) {
                energy = Math.min(5, energy + elapsed);
                lastEnergyUpdate += elapsed * REGEN_TIME;
                saveProgress();
            }
            rollsLeft = energy;
        }

        function updateUI() {
            document.getElementById('coins').textContent = `–ú–æ–Ω–µ—Ç—ã: ${Math.floor(coins).toLocaleString()}`;
            const rollBtn = document.getElementById('rollBtn');
            rollBtn.textContent = `üé≤ –ö—Ä—É—Ç–∏—Ç—å! (${rollsLeft}/5)`;
            rollBtn.disabled = rollsLeft <= 0;
            
            const prestigeBtn = document.getElementById('prestigeBtn');
            prestigeBtn.disabled = !unlocked.every(u => u);
            prestigeBtn.textContent = `üîÑ Prestige ${prestigeLevel}`;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            const progressPercent = (energy / 5) * 100;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
            
            updateBoard();
        }

        function updateBoard() {
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            
            for (let i = 0; i < boardSize; i++) {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.dataset.index = i;
                
                if (i === currentPosition) slot.classList.add('current');
                
                if (!unlocked[i]) {
                    const cost = unlockCost(i);
                    slot.innerHTML = `üîí<br>${cost.toLocaleString()}`;
                    slot.classList.add('locked');
                } else {
                    slot.innerHTML = `x${(multipliers[i] * globalMulti).toFixed(1)}`;
                    slot.classList.add('unlocked');
                }
                
                slot.onclick = () => handleSlot(i);
                boardEl.appendChild(slot);
            }
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
            setTimeout(() => {
                const currentSlot = document.querySelector(`[data-index="${currentPosition}"]`);
                if (currentSlot) {
                    currentSlot.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
                }
            }, 100);
        }

        function unlockCost(i) { 
            return Math.floor(500 * Math.pow(1.5, i) * Math.pow(2, prestigeLevel)); 
        }
        
        function upgradeCost(i) { 
            return Math.floor(800 * multipliers[i] * Math.pow(2, prestigeLevel)); 
        }

        function handleSlot(i) {
            if (tg && tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }
            
            if (!unlocked[i]) {
                const cost = unlockCost(i);
                if (coins >= cost) {
                    coins -= cost;
                    unlocked[i] = true;
                    showAlert('–°–ª–æ—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω! üöÄ');
                } else {
                    showAlert(`–ù—É–∂–Ω—ã ${cost.toLocaleString()} –º–æ–Ω–µ—Ç ‚òùÔ∏è`);
                }
            } else {
                const cost = upgradeCost(i);
                if (coins >= cost) {
                    coins -= cost;
                    multipliers[i] *= 1.5;
                    showAlert(`–£–ª—É—á—à–µ–Ω–æ –¥–æ x${(multipliers[i] * globalMulti).toFixed(1)}! üí•`);
                } else {
                    showAlert(`–ù—É–∂–Ω—ã ${cost.toLocaleString()} –º–æ–Ω–µ—Ç ‚òùÔ∏è`);
                }
            }
            updateUI();
            saveProgress();
        }

        function roll() {
            if (rollsLeft <= 0) return;
            
            if (tg && tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('heavy');
            }
            
            const diceEl = document.getElementById('dice');
            diceEl.classList.add('anim');
            
            setTimeout(() => {
                diceEl.classList.remove('anim');
                const steps = Math.floor(Math.random() * 6) + 1;
                let reward = 0;
                let path = [];
                let tempPos = currentPosition;
                let hasJackpot = false;
                
                rollsSinceJackpot++;
                
                for (let i = 0; i < steps; i++) {
                    tempPos = (tempPos + 1) % boardSize;
                    path.push(tempPos);
                    
                    if (unlocked[tempPos]) {
                        let slotR = multipliers[tempPos] * globalMulti;
                        let bonus = getBonus();
                        
                        if (bonus === 'x2') slotR *= 2;
                        if (bonus === 'jackpot' || rollsSinceJackpot >= PITY_ROLLS) {
                            slotR *= 10;
                            hasJackpot = true;
                            rollsSinceJackpot = 0;
                            showConfetti();
                        }
                        
                        reward += slotR;
                    }
                }
                
                coins += reward;
                currentPosition = tempPos;
                animatePath(path);
                
                showAlert(`${hasJackpot ? 'üí• –ö–†–ò–¢–ò–ß–ù–´–ô –£–î–ê–†!' : 'üéâ'} ${steps} —à–∞–≥–æ–≤! +${Math.floor(reward)} –º–æ–Ω–µ—Ç!`);
                
                energy--;
                lastEnergyUpdate = Date.now();
                updateEnergy();
                updateUI();
                saveProgress();
                
            }, 1300);
        }

        function getBonus() {
            const rand = Math.random();
            if (rand < 0.7) return 'none';
            if (rand < 0.9) return 'x2';
            return 'jackpot';
        }

        function animatePath(path) {
            path.forEach((pos, idx) => {
                setTimeout(() => {
                    document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
                    const slot = document.querySelector(`[data-index="${pos}"]`);
                    if (slot) {
                        slot.classList.add('highlight');
                        if (tg && tg.HapticFeedback) {
                            tg.HapticFeedback.impactOccurred('light');
                        }
                    }
                }, idx * 280);
            });
            
            setTimeout(() => {
                document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
            }, path.length * 280 + 600);
        }

        function claimDaily() {
            const now = Date.now();
            const today = Math.floor(now / DAY_MS);
            
            if (today > lastDailyClaim) {
                coins += 500 * globalMulti;
                lastDailyClaim = today;
                showAlert('üåü +' + Math.floor(500 * globalMulti) + ' –º–æ–Ω–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ!');
                updateUI();
                saveProgress();
            } else {
                showAlert('–£–∂–µ –≤–∑—è—Ç–æ —Å–µ–≥–æ–¥–Ω—è! –ó–∞–≤—Ç—Ä–∞ –µ—â—ë üëÄ');
            }
        }

        function watchAd() {
            energy = Math.min(5, energy + 3);
            updateEnergy();
            showAlert('üì∫ +3 –∫—Ä—É—Ç–∫–∏! –ì–æ—Ç–æ–≤–æ üöÄ');
            updateUI();
            saveProgress();
        }

        function prestige() {
            if (!unlocked.every(u => u)) return;
            
            prestigeLevel++;
            globalMulti += 0.1;
            unlocked = Array(boardSize).fill(false);
            unlocked[0] = true;
            unlocked[1] = true;
            unlocked[2] = true;
            multipliers = Array(boardSize).fill(1);
            currentPosition = 0;
            coins = 0;
            
            showAlert(`üîÑ Prestige ${prestigeLevel}! +10% –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä! üåü`);
            updateUI();
            saveProgress();
        }

        function showHelp() {
            document.getElementById('tutorial-modal').style.display = 'flex';
        }

        function showAlert(message) {
            if (tg && tg.showAlert) {
                tg.showAlert(message);
            } else {
                alert(message);
            }
        }

        function showConfetti() {
            const confettiEl = document.getElementById('confetti');
            confettiEl.style.display = 'block';
            
            // –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
            confettiEl.innerHTML = '';
            for (let i = 0; i < 50; i++) {
                const dot = document.createElement('div');
                dot.style.position = 'absolute';
                dot.style.width = '10px';
                dot.style.height = '10px';
                dot.style.background = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'][Math.floor(Math.random() * 5)];
                dot.style.borderRadius = '50%';
                dot.style.left = Math.random() * 100 + 'vw';
                dot.style.top = '-20px';
                dot.style.animation = `fall ${1 + Math.random() * 2}s linear forwards`;
                
                // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–∞–¥–µ–Ω–∏—è
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes fall {
                        to { transform: translateY(100vh) rotate(${Math.random() * 360}deg); opacity: 0; }
                    }
                `;
                confettiEl.appendChild(style);
                confettiEl.appendChild(dot);
            }
            
            setTimeout(() => {
                confettiEl.style.display = 'none';
                confettiEl.innerHTML = '';
            }, 2000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('rollBtn').onclick = roll;
            document.getElementById('adBtn').onclick = watchAd;
            document.getElementById('dailyBtn').onclick = claimDaily;
            document.getElementById('prestigeBtn').onclick = prestige;
            document.getElementById('helpBtn').onclick = showHelp;
            document.getElementById('dice').onclick = roll;
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.getElementById('tutorial-modal').onclick = function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            };
            
            loadProgress();
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            setInterval(() => {
                updateEnergy();
                updateUI();
            }, 60000);
        });
    </script>
</body>
</html>